# Metaballs
This project implements the Marching Squares Algorithm using Python and the Pygame library.

## Marching Squares Algorithm
Marching Squares is the 2D counterpart of the well-known Marching Cubes algorithm, primarily used for mesh reconstruction. The algorithm's objective is to reconstruct an isosurface (or isoline in 2D) based on a function and a threshold value.

### Main Steps of the Algorithm
1. Define a function to evaluate each coordinate point (x, y) in space and set a threshold value.
2. Divide the space into a square grid.
3. Evaluate the vertices of each square using the defined function.
4. Classify each vertex as inside or outside the isosurface based on whether it is above or below the threshold.
5. Draw the isosurface portion inside each square, considering which vertices are inside or outside.

For this project, the Marching Squares algorithm is used to create a Metaball effect. A set of 15 circles is generated, and the function for evaluating space coordinates (x, y) is based on the relative distance from each circle's center.

## Code Overview
The goal was to achieve a smooth visualization of the desired effect at a resolution of 1280x720 (HD).
- **Number of circles:** 15
- **Square size:** 10

Performance metrics were tracked for different code versions:
- **FPS (Frames Per Second)**
- **Update time** (time taken to evaluate each grid vertex and perform calculations)
- **Draw time** (time taken to render the output)

### Test Environment
- **OS:** Pop!_OS v22.04
- **CPU:** Intel i7-12700K
- **RAM:** 32 GB (6000 MT/s, CL36)
- **GPU Utilization:** None (calculations were done on the CPU, with no parallelization)

### Version 1
- **Implementation:**
  - An object for each circle
  - An object for each square
  - Singular calculations for each square vertex
- **Results:**
  - FPS: ~6.7
  - Update time: ~140 ms
  - Draw time: ~1.8 ms

### Version 2
- **Improvements:**
  - An object for each circle
  - A single object to handle all vertices and drawing
  - Calculations still performed per vertex
- **Results:**
  - FPS: ~25
  - Update time: ~38 ms
  - Draw time: ~1.45 ms

### GPT Version
- **Generated by:** ChatGPT 4o (file `gpt.py`)
- **Outcome:**
  - Despite various optimization attempts, the graphical effect was not retained.
  - The output was incorrect and not evaluated further.

### Claude Version 1
- **Generated by:** Claude Sonnet v3.7 (file `claude.py`)
- **Results:**
  - FPS: ~8
  - Update time: ~122 ms
  - Draw time: ~1 ms

### Claude Version 2
- **Generated by:** Claude Sonnet v3.7 (file `claude2.py`)
- **Approach:**
  - Avoided using the square root function for distance calculations
  - Used a more efficient pattern recognition method for drawing the isoline
- **Results:**
  - FPS: ~32
  - Update time: ~25 ms
  - Draw time: ~1 ms

### Version 3
- **Final Optimized Version (file `v3.py`)**
- **Improvements:**
  - A single object manages all circles
  - A single object manages all squares
  - Utilized NumPy matrices for storing vertices and circles, optimizing calculations
  - Optimized the drawing function to eliminate redundant computations
- **Results:**
  - FPS: ~98
  - Update time: ~8 ms
  - Draw time: ~1.5 ms

## Further Optimization Attempts
Running Version 3 at 1920x1080 (Full HD) resulted in FPS dropping below 60, which was below the target. However, by adjusting grid size and threshold values:
- **Grid size:** 20
- **Threshold:** 1
- **Number of circles:** 20 (for better visualization)

This achieved **80+ FPS at 2K resolution**, but the results are not directly comparable due to changes in grid resolution and threshold adjustments.

### Potential Future Optimizations
- **Parallelization:** Utilizing multi-threading or multiprocessing could further enhance performance.
- **GPU Acceleration:** Offloading computations to the GPU via OpenGL or CUDA could be a game-changer for performance.

## Example Output


https://github.com/user-attachments/assets/8e601452-8cfe-4961-9e2c-d996759d8394



## Full Code Explanation
A detailed explanation of the algorithm and the first version of the code is available here: [Twitch Video](https://www.twitch.tv/videos/2410066509). If the VOD expires, feel free to reach out.
```

